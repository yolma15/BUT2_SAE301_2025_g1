<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ajout Produit</title>
  <link rel="stylesheet" href="/css/ajout_produit.css">
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet">
</head>
<body>
  
  <%- include('header'); %>

  <main>
    <div class="form-wrapper">
      
      <h1>Ajout Produits</h1>

      <% if (typeof message !== 'undefined' && message) { %>
        <div class="alert-message">
          <%= message %>
        </div>
      <% } %>

      <form action="/agent/ajout_produit" method="POST" class="add-product-form" enctype="multipart/form-data">
        
        <div class="form-grid-layout">
            
            <div class="left-inputs">
                <div class="input-wrapper">
                    <select name="type" required>
                        <option value="" disabled selected>Type de produit</option>
                        <option value="Vélo">Vélo</option>
                        <option value="Tapis de course">Tapis de course</option>
                        <option value="Rameur">Rameur</option>
                        <option value="Elliptique">Elliptique</option>
                        <option value="Musculation">Musculation</option>
                        <option value="Autre">Autre</option>
                    </select>
                </div>
                <div class="input-wrapper">
                    <input type="text" name="marque" placeholder="Marque (ex: Technogym)" required>
                </div>
                <div class="input-wrapper">
                    <input type="text" name="modele" placeholder="Modèle (ex: MyRun 500)" required>
                </div>
                <div class="input-wrapper">
                    <input type="number" name="prix_location" step="0.01" min="0" placeholder="Prix location (€/jour)" required>
                </div>
                <div class="input-wrapper">
                    <select name="etat" required>
                        <option value="disponible">État: Disponible</option>
                        <option value="maintenance">État: Maintenance</option>
                        <option value="hors_service">État: Hors service</option>
                    </select>
                </div>
                <div class="input-wrapper">
                    <textarea name="description" rows="4" placeholder="Détails / Description technique..."></textarea>
                </div>
            </div>

            <div class="right-image-area">
                <div class="image-box">
                    
                    <img id="image-preview-tag" src="#" alt="Aperçu">

                    <div class="upload-controls">
                        <input type="file" name="image" id="real-file" accept="image/*" onchange="previewImage(event)">
                        <label for="real-file" class="btn-image">Ajout image</label>
                        <span id="file-chosen">Aucun fichier choisi</span>
                    </div>
                </div>
            </div>

        </div>

        <button type="submit" class="btn-submit">Ajouter</button>

      </form>
    </div>
  </main>

  <%- include('footer'); %>

  <script>
    function previewImage(event) {
        const input = event.target;
        const previewTag = document.getElementById('image-preview-tag');
        const fileNameSpan = document.getElementById('file-chosen');
        const uploadControls = document.querySelector('.upload-controls');

        // Vérifie si un fichier a été sélectionné
        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function(e) {
                // On attribue le résultat de la lecture (l'image en base64) au src de l'img
                previewTag.src = e.target.result;
                // On affiche l'image
                previewTag.style.display = 'block';
                // On cache le texte "Aucun fichier choisi" car c'est redondant
                fileNameSpan.style.display = 'none';
                // Optionnel : changer le texte du bouton
                document.querySelector('.btn-image').textContent = "Changer l'image";
            }

            // Lance la lecture du fichier
            reader.readAsDataURL(input.files[0]);
        } else {
            // Si l'utilisateur annule la sélection, on réinitialise
            previewTag.src = '#';
            previewTag.style.display = 'none';
            fileNameSpan.style.display = 'block';
            fileNameSpan.textContent = "Aucun fichier choisi";
             document.querySelector('.btn-image').textContent = "Ajout image";
        }
    }
  </script>

</body>
</html>